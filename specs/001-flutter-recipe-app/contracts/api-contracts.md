# API Contracts: dinner.niessl.org JSON Interface

**Branch**: `001-flutter-recipe-app` | **Date**: 2026-02-19
**Base URL**: `https://dinner.niessl.org`

---

## Overview

The app consumes a read-only, static JSON API generated by Hugo. All endpoints are
public HTTPS GET endpoints with no authentication. Responses are served with standard
HTTP caching headers.

---

## Endpoints

### GET /recipes/index.json

Returns the full list of all available recipes.

**Request**
```
GET https://dinner.niessl.org/recipes/index.json
Headers: (none required)
```

**Response 200 OK**
```json
[
  {
    "name": "Financiers",
    "url": "https://dinner.niessl.org/recipes/financiers/index.json"
  },
  {
    "name": "Florentiner",
    "url": "https://dinner.niessl.org/recipes/florentiner/index.json"
  }
]
```

**Schema**
```
Array<RecipeIndexEntry>

RecipeIndexEntry:
  name: string   — non-empty display name
  url:  string   — absolute HTTPS URL to the recipe detail endpoint
```

**App usage**: Fetched once on startup. Used to populate `List<RecipeSummary>`.

---

### GET /tags/index.json

Returns the full list of available category tags.

**Request**
```
GET https://dinner.niessl.org/tags/index.json
Headers: (none required)
```

**Response 200 OK**
```json
[
  { "name": "sweet", "url": "https://dinner.niessl.org/tags/sweet/index.json" },
  { "name": "basis", "url": "https://dinner.niessl.org/tags/basis/index.json" },
  { "name": "indian", "url": "https://dinner.niessl.org/tags/indian/index.json" },
  { "name": "main",  "url": "https://dinner.niessl.org/tags/main/index.json"  },
  { "name": "snack", "url": "https://dinner.niessl.org/tags/snack/index.json" },
  { "name": "fish",  "url": "https://dinner.niessl.org/tags/fish/index.json"  }
]
```

**Schema**
```
Array<TagIndexEntry>

TagIndexEntry:
  name: string   — tag name (lower-case)
  url:  string   — absolute HTTPS URL to the tag's recipe list endpoint
```

**App usage**: Fetched once on startup in parallel with /recipes/index.json.

---

### GET /tags/{tag}/index.json

Returns all recipes that belong to a given tag.

**Request**
```
GET https://dinner.niessl.org/tags/{tag}/index.json
  tag: one of: sweet | basis | indian | main | snack | fish
```

**Response 200 OK** (example: /tags/indian/index.json)
```json
[
  { "name": "Aloo Matar",          "url": "https://dinner.niessl.org/recipes/aloo-matar/index.json" },
  { "name": "Dal Tadka",           "url": "https://dinner.niessl.org/recipes/dal-tadka/index.json" },
  { "name": "Chana Masala",        "url": "https://dinner.niessl.org/recipes/chana-masala/index.json" },
  { "name": "Paneer Butter Masala","url": "https://dinner.niessl.org/recipes/paneer-butter-masala/index.json" }
]
```

**Schema**
```
Array<RecipeIndexEntry>   (same shape as /recipes/index.json)
```

**App usage**: All 6 tag indices are fetched in parallel after /recipes/index.json
and /tags/index.json complete. The `url` field is used as a join key against the
main recipe list to build tag membership on each `RecipeSummary`.

---

### GET /recipes/{slug}/index.json

Returns the full content for a single recipe.

**Request**
```
GET https://dinner.niessl.org/recipes/{slug}/index.json
  slug: URL path segment (e.g., "financiers", "paneer-butter-masala")
```

**Response 200 OK**
```json
{
  "name": "Financiers",
  "recipe": "## Ingredients\n\n* ½ cup of unsalted butter 100 g\n* ¾ cup of powdered sugar 100 g\n...\n\n## Directions\n\n1. Preheat the oven to 180°C.\n2. Melt the butter..."
}
```

**Schema**
```
RecipeDetail:
  name:   string  — non-empty display name (matches RecipeSummary.name)
  recipe: string  — recipe content as Markdown
                    Structure:
                      "## Ingredients\n\n* [qty] [item]\n...\n\n## Directions\n\n1. [step]\n..."
```

**App usage**: Fetched on demand when the user taps a recipe in the list. The full
URL from `RecipeSummary.url` is used directly as the request URL. Cached in
shared_preferences after first load.

---

## Error Handling Contract

| Scenario | Expected HTTP status | App behaviour |
|----------|---------------------|---------------|
| Successful response | 200 OK | Parse JSON, update state |
| Network unreachable | (no response / timeout) | Show error view with retry action; serve cached data if available |
| 404 Not Found | 404 | Show error view ("Recipe not found") |
| 5xx Server Error | 5xx | Show error view with retry action |
| Invalid JSON | 200 with malformed body | Log error, show error view |

**Timeout**: HTTP requests timeout after 10 seconds. No automatic retry on timeout;
the user triggers retry manually via the retry button.

---

## Caching Contract

All responses are cached in `shared_preferences` keyed as described in data-model.md.

**Cache-first read order**:
1. Check `shared_preferences` for cached data.
2. If found: populate UI immediately.
3. In background: fetch fresh data from API.
4. On success: update UI and overwrite cache.
5. On failure: retain cached data, show a non-blocking banner if desired.

---

## Client Requirements

- HTTPS only (HTTP redirects must be followed or blocked by platform).
- JSON content type expected; the `Content-Type` header from the server is
  `application/json` or `text/plain`.
- No API key or authorization header.
- No request body (all GET).
- All URLs are absolute and should be used as-is from the index responses.
