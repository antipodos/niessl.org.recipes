# Implementation Plan: App Icon Branding & Detail Photo Overlay Redesign

**Branch**: `004-icon-detail-overlay` | **Date**: 2026-02-21 | **Spec**: [spec.md](spec.md)
**Input**: Feature specification from `/specs/004-icon-detail-overlay/spec.md`

---

## Summary

Replace the generic Flutter launcher icon and blank splash with the niessl.org logo. On the recipe detail screen, remove the redundant recipe name from the photo overlay and replace it with a unified semi-transparent white bar showing tags (as label icon + plain text) and the source link (as link icon + plain text), moving both out of the scrollable body below the photo.

---

## Technical Context

**Language/Version**: Dart 3.9.2 / Flutter 3.35.6
**Primary Dependencies**: flutter_riverpod 2.6.1, cached_network_image 3.3.x, url_launcher 6.2.x, wakelock_plus 1.4.0; `flutter_native_splash ^2.4.7` (existing dev); `flutter_launcher_icons ^0.14.x` (new dev)
**Storage**: SharedPreferences (unchanged — no new storage)
**Testing**: flutter_test (unit + widget), integration_test (emulator)
**Target Platform**: Android + iOS
**Project Type**: Mobile Flutter app
**Performance Goals**: No new async operations in the render critical path; icon/splash assets generated at build time
**Constraints**: Tests must pass with ≥80% coverage; `flutter analyze` zero warnings; `dart format` zero diffs
**Scale/Scope**: 2 files changed in `lib/`; 2 test files updated; `pubspec.yaml` + 1 new asset

---

## Constitution Check

### Pre-implementation gate check

| Principle | Status | Notes |
|-----------|--------|-------|
| I. Code Quality | ✅ Pass | Single responsibility maintained; overlay bar is a `Positioned` subtree within existing Stack; no abstraction introduced for one-off use |
| II. Test-First | ✅ Required | Tests written and confirmed failing before implementation for all changed behaviour |
| III. UX Consistency | ✅ Pass | Tag icon+text style matches existing source link style; uses `colorScheme` tokens; no raw hard-coded values except opacity constant (documented) |
| IV. Performance | ✅ Pass | Logo assets generated at build time; no new network calls; overlay bar is pure layout — no additional async operations |

**Quality Gates to clear before merge**:
1. Green tests — all unit + widget + integration pass
2. Coverage ≥ 80% on changed code
3. `flutter analyze` zero issues; `dart format` zero diffs
4. Visual verification on emulator: icon, splash, detail overlay

---

## Project Structure

### Documentation (this feature)

```text
specs/004-icon-detail-overlay/
├── plan.md              # This file
├── research.md          # Phase 0 — logo URL, tooling decisions, overlay design
├── data-model.md        # Phase 1 — display logic rules, asset inventory
├── quickstart.md        # Phase 1 — setup and verification steps
├── checklists/
│   └── requirements.md  # Spec quality checklist (all pass)
└── tasks.md             # Phase 2 — generated by /speckit.tasks
```

### Source Code (repository root)

```text
assets/
└── logo.png                          # NEW — downloaded from niessl.org/img/logo.png

lib/
└── screens/
    └── recipe_detail_screen.dart     # MODIFIED — overlay redesign

test/
└── widget/
    └── screens_widget_test.dart      # MODIFIED — 4 tests updated for new overlay

integration_test/
└── app_test.dart                     # MODIFIED — US4 tag-tap test removed; US6 updated

pubspec.yaml                          # MODIFIED — flutter_launcher_icons dev dep + config;
                                      #            flutter_native_splash image: field
```

**Structure Decision**: Single Flutter mobile project (no backend, no separate packages). All changes are co-located within the existing project layout.

---

## Phase 0: Research Summary

All unknowns resolved — see [research.md](research.md) for full rationale.

| Topic | Decision |
|-------|----------|
| Logo source | `https://niessl.org/img/logo.png` |
| App icon tooling | `flutter_launcher_icons ^0.14.x` (new dev dep) |
| Splash tooling | `flutter_native_splash` (existing) — add `image: assets/logo.png` |
| Overlay bar style | `Colors.white.withValues(alpha: 0.78)` semi-transparent; `Wrap` of `Row(icon+text)` items |
| Tag interactivity | Read-only (no filter navigation from overlay) |
| Source filtering | Exclude `null`, empty string, and `"unknown"` (existing guard already present) |

---

## Phase 1: Design

### US1 — App Icon & Splash Branding

**pubspec.yaml changes**:

```yaml
dev_dependencies:
  flutter_launcher_icons: ^0.14.0   # NEW

flutter_launcher_icons:             # NEW section
  android: true
  ios: true
  image_path: "assets/logo.png"
  adaptive_icon_background: "#FFFFFF"
  adaptive_icon_foreground: "assets/logo.png"
  min_sdk_android: 21
  web:
    generate: false

flutter_native_splash:              # EXISTING — add image field
  image: assets/logo.png            # NEW line
  color: "#F5EFE7"
  color_dark: "#2B1F1A"
  android_12:
    image: assets/logo.png          # NEW line
    color: "#F5EFE7"
    color_dark: "#2B1F1A"
  android: true
  ios: true
  fullscreen: false
```

**Build commands** (run after pubspec changes):

```bash
dart run flutter_launcher_icons
dart run flutter_native_splash:create
```

### US2 — Detail Photo Overlay Redesign

**`recipe_detail_screen.dart` — Hero Stack children** (replace existing gradient + name overlay):

```
Stack(fit: StackFit.expand, children: [
  // 1. Photo (CachedNetworkImage or placeholder) — UNCHANGED
  // 2. REMOVE: gradient scrim Positioned
  // 3. REMOVE: name text Positioned
  // 4. ADD: info bar Positioned(bottom: 0)
  //    Container(color: Colors.white.withValues(alpha: 0.78))
  //      Padding(8 all)
  //        Wrap(spacing: 12, runSpacing: 4, children: [
  //          ...widget.tags.map((t) => _TagItem(t)),
  //          if (source valid) _SourceItem(source),
  //        ])
  //    Only rendered when: tags non-empty OR source valid
])
```

**Remove from body below photo**:
- `FilterChip` tags `Wrap` section (lines 172–192 in current file)
- Source `InkWell` section (lines 194–219 in current file)
- Keep `Divider` and `MarkdownBody` unchanged

**Helper widgets** (private, inline in same file — Rule of Three not yet met):

```dart
// Tag row: label icon + tag name text
Widget _buildTagItem(String tag, TextTheme textTheme, ColorScheme cs) =>
  Row(mainAxisSize: MainAxisSize.min, children: [
    Icon(Icons.label_outline, size: 14, color: cs.onSurface),
    const SizedBox(width: 4),
    Text(tag, style: textTheme.bodySmall?.copyWith(color: cs.onSurface)),
  ]);

// Source row: open_in_new icon + hostname text (tappable)
Widget _buildSourceItem(String source, TextTheme textTheme, ColorScheme cs) =>
  GestureDetector(
    onTap: () async { await launchUrl(Uri.parse(source)); },
    child: Row(mainAxisSize: MainAxisSize.min, children: [
      Icon(Icons.open_in_new, size: 14, color: cs.primary),
      const SizedBox(width: 4),
      Text(
        Uri.parse(source).host,
        style: textTheme.bodySmall?.copyWith(color: cs.primary),
      ),
    ]),
  );
```

### Test Changes

**Widget tests — `screens_widget_test.dart`**:

| Existing test | Action |
|---------------|--------|
| `shows FilterChip for each tag when tags provided` | Replace `find.widgetWithText(FilterChip, ...)` with `find.text('Italian')` + `find.byIcon(Icons.label_outline)` |
| `recipe name appears inside Hero subtree when loaded` | Remove — name intentionally no longer in Hero |
| `standalone name heading below photo is removed after overlay added` | Update: verify name NOT inside Hero; verify it IS in AppBar only |
| `loaded state with media shows Hero, name heading, source link, Divider` | Rename to `loaded state with media shows Hero, overlay bar, and Divider`; check for `Icons.open_in_new` inside Hero subtree |
| `shows no FilterChip when tags is empty` | Keep as-is — still valid |

**Integration tests — `app_test.dart`**:

| Existing test | Action |
|---------------|--------|
| `US4: tapping a detail tag chip returns to filtered list` | Remove — tags are now read-only in the detail overlay |
| `US6: detail screen shows name heading, photo area, and Divider` | Update assertion: name is in AppBar only; check overlay bar icons instead of name heading inside Hero |

---

## Complexity Tracking

No constitution violations. No new abstractions, no new layers, no new dependencies beyond the standard icon-generation dev tool.
